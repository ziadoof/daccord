{% extends "layout_user.html.twig" %}
{% block title %}My Voyage{% endblock %}

{% block content %}
        <h5 class="text-center blued">My voyage</h5>
        <div class="voyag-index">
            {% if app.user.carpool %}
             <div class="row">
                 <div class="col-md-2 offset-10 mb-4">
                     <a class="btn btn-block btn-info" href="{{ path('voyage_new',{'type':'first'}) }}">New voyage</a>
                 </div>
             </div>
            {% endif %}
            {% if voyages is not empty %}
                {% for voyage in voyages %}
                    {% if voyage.isPassenger(app.user) or voyage.creator.user is same as (app.user) %}
                        <div class="row">
                            <div class="col-md-12 px-2">
                                <div id="meetup_index" class="meetup_index border-deal">
                                    <a href="{{ path('voyage_show', {'id': voyage.id}) }}"class="">
                                        <div class="px-2">
                                            <div class="row">
                                                <div class="col-md-3 my-1 image_meetup_index">
                                                    <img class="" src="{{ voyage.creator.photoCarpool() }}" alt="car image"/>
                                                </div>
                                                <div class="col-md-9  py-2">
                                                    <div class="row">
                                                        <div class="col-md-11">
                                                            <div class="">
                                                                <h4 class="meetup-text blued d-inline">{{ voyage.stationDeparture.name }}</h4>
                                                                <i class="fas fa-arrow-right rosed d-inline mx-4"></i>
                                                                <h4 class="meetup-text blued d-inline">{{ voyage.stationArrival.name }}</h4>
                                                            </div>
                                                            <div class="">
                                                                <span class=" mt-3"><span class="blued">{{ 'Date : ' }}</span>{{ voyage.timeDeparture|date('d M Y') }}</span>
                                                            </div>
                                                            <div class="">
                                                                <span class=" mt-3"><span class="blued">{{ 'Time : ' }}</span>{{ voyage.timeDeparture|date('H:i') }}</span>
                                                            </div>
                                                            <div class="mt-1">
                                                                <img src="{{ voyage.creator.user.photoProfile() }}" alt="" class="cafe-avatar mr-2">
                                                                <span class="d-block blued small">{{ voyage.creator.user.firstname }}</span>
                                                                <span class="d-block blued small">{{ voyage.creator.point }}{{ ' Points' }}</span>
                                                                <span class=" blued small">{{ voyage.creator.point }}<i class="far fa-star rosed"></i></span>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-1">
                                                        {% if  voyage.isFinish() %}
                                                            <span class="badge badge-danger mt-1 btn-block"><h7>Finish</h7></span>
                                                        {% else %}
                                                            {% if voyage.getAvailableSeats(voyage) > 0 %}
                                                                <span class="badge badge-info float-right">
                                                                <h7>
                                                                    {{voyage.getAvailableSeats(voyage) }}
                                                                    {% if voyage.getAvailableSeats(voyage)>1 %}Seats {% else %} Seat{% endif %}
                                                                    available
                                                                </h7>
                                                            </span>
                                                            {% else %}
                                                                <span class="badge badge-danger float-right"><h7>Closed Voyage</h7></span>
                                                            {% endif %}
                                                        {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    {% if  voyage.isFinish() %}
                                        {% if app.user is not same as(voyage.creator.user) %}
                                            {% if votesVoyage[voyage.creator.user.id] is defined  %}
                                                <p class="blued text-center py-1">  Your rating for this voyage :
                                                    {% set reste = 5 - votesVoyage[voyage.creator.user.id]%}
                                                    {% if  votesVoyage[voyage.creator.user.id] is not same as(null)%}
                                                        {% for  i in votesVoyage[voyage.creator.user.id] ..1%}
                                                            <i class="fas fa-star"></i>
                                                        {% endfor %}
                                                        {% if reste>0 %}
                                                            {% for  i in reste..1%}
                                                                <i class="far fa-star"></i>
                                                            {% endfor %}
                                                        {% endif %}
                                                    {% else %}
                                                        {% for  i in 5..1%}
                                                            <i class="far fa-star"></i>
                                                        {% endfor %}
                                                    {% endif %}
                                                </p>
                                            {% else %}
                                                <button  data-toggle="modal" class="btn btn-outline-info btn-block mt-0"
                                                         data-target="#voyage_vote-{{ voyage.creator.user.id }}">
                                                    <i class="far fa-star"></i> Rate this voyage
                                                </button>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                <div class="pagination-search row justify-content-center mt-4">
                    <div class="navigation">
                        {{ knp_pagination_render(voyages) }}
                    </div>
                </div>
            {% else %}
                <h1 class="text-center title-blue">You have not voyages</h1>
            {% endif %}
        </div>

    {% if listCarpool is not empty %}
        {% for carpoolId in listCarpool %}
            {% if votesVoyage[carpoolId] is not defined %}
                <div class="modal fade bd-example-modal-lg mt-4" id="voyage_vote-{{ carpoolId }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index: 9999;">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                            aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel"></h4>
                            </div>
                            <div class="modal-body">
                                {{ render(controller('App\\Controller\\RatingController::createVote',{ 'candidate': carpoolId, 'type':'carpool' })) }}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock %}
